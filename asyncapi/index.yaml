asyncapi: '2.6.0'
info:
  title: Farcaster WebSocket API
  version: '1.0.0'
  description: AsyncAPI specification for the Farcaster WebSocket stream endpoint
servers:
  production:
    url: wss://ws.farcaster.xyz/stream
    protocol: wss
channels:
  '/':
    subscribe:
      summary: Receive events from the Farcaster stream
      operationId: onMessage
      message:
        oneOf:
          - $ref: '#/components/messages/unseenMessage'
          - $ref: '#/components/messages/refreshDirectCastConversationMessage'
    publish:
      summary: Send commands to the Farcaster stream
      operationId: sendMessage
      message:
        oneOf:
          - $ref: '#/components/messages/authenticateMessage'
          - $ref: '#/components/messages/directCastReadMessage'
components:
  messages:
    authenticateMessage:
      contentType: application/json
      payload:
        type: object
        properties:
          messageType:
            type: string
            enum:
              - authenticate
          data:
            type: string
            description: Bearer token used for authentication
        required:
          - messageType
          - data

    directCastReadMessage:
      contentType: application/json
      payload:
        type: object
        properties:
          messageType:
            type: string
            enum:
              - direct-cast-read
          payload:
            type: object
            properties:
              conversationId:
                type: string
            required:
              - conversationId
          data:
            type: string
            description: Identifier of the conversation to subscribe to
        required:
          - messageType
          - payload
          - data

    unseenMessage:
      contentType: application/json
      payload:
        type: object
        properties:
          messageType:
            type: string
            enum:
              - unseen
          data:
            type: string
            description: JSON string containing unseen data that can be parsed to either inbox count or channel feeds status
        required:
          - messageType
          - data

    refreshDirectCastConversationMessage:
      contentType: application/json
      payload:
        type: object
        properties:
          messageType:
            type: string
            enum:
              - refresh-direct-cast-conversation
          payload:
            type: object
            properties:
              conversationId:
                type: string
              message:
                type: object
                properties:
                  conversationId:
                    type: string
                  message:
                    type: string
                  messageId:
                    type: string
                  senderFid:
                    type: integer
                  serverTimestamp:
                    type: integer
                  type:
                    type: string
                  isDeleted:
                    type: boolean
                  senderContext:
                    type: object
                    properties:
                      displayName:
                        type: string
                      fid:
                        type: integer
                      pfp:
                        type: object
                        properties:
                          url:
                            type: string
                          verified:
                            type: boolean
                        required:
                          - url
                          - verified
                      username:
                        type: string
                    required:
                      - displayName
                      - fid
                      - pfp
                      - username
                  reactions:
                    type: array
                    items:
                      type: object
                  hasMention:
                    type: boolean
                  isPinned:
                    type: boolean
                  mentions:
                    type: array
                    items:
                      type: object
                required:
                  - conversationId
                  - message
                  - messageId
                  - senderFid
                  - serverTimestamp
                  - type
                  - isDeleted
                  - senderContext
                  - reactions
                  - hasMention
                  - isPinned
                  - mentions
            required:
              - conversationId
              - message
          data:
            type: string
            description: Identifier of the conversation
        required:
          - messageType
          - payload
          - data
  schemas:
    unseenData:
      oneOf:
        - type: object
          properties:
            inboxCount:
              type: integer
          required:
            - inboxCount
        - type: object
          properties:
            channelFeedsUnseenStatus:
              type: array
              items:
                type: object
                properties:
                  channelKey:
                    type: string
                  feedType:
                    type: string
                  hasNewItems:
                    type: boolean
                required:
                  - channelKey
                  - feedType
                  - hasNewItems
          required:
            - channelFeedsUnseenStatus
